---
layout: post
title:  "SPA设计与架构 - 核心概念"
date:   2017-09-28 01:21:03
categories: 读书笔记
---

> 介绍SPA应用中，各部分的协同运作以及测试和任务自动化

# 单页面导航

## 客户端路由器的概念

- 传统导航 - 导航是以*整个页面*为单位进行的，每次显示新的内容，都执行一次*完整的html页面刷新*
- SPA导航 - 通过*客户端路由器*监听URL的变化，与*配置项*进行匹配后，借助*动态加载等*技术手段，从服务端获取*数据和模板*，动态的刷新页面*DOM中的某些部分*

## 路由及其配置

无论使用哪种路由器，都必须进行一些*事先的配置*，必须通过配置项来指定路由器在*用户导航时的响应策略*

一些通用的概念：

- 名称 - 单独指定名称或者将路径看作名称
- 动词 - HTTP协议中的动词或其他一些框架自定义的动词
- 路径 - URL的匹配规则
- 功能 - 可能执行的相关代码，如控制器或回调函数
- 视图 - 大部分是到HTML某部分的路径，路由器会处理它的显示
- 参数 - 定义在url中，通过特殊语法进行传入和提取的变量

## 客户端路由器的工作机制

基本特性：

- 通过路由定义的路径来*匹配URL模式*
- 当匹配成功时允许应用程序*执行代码*
- 当路由触发时允许*指定具体视图*
- 允许通过路由*路径传入参数*
- 允许用户使用标准的*浏览器导航*方法来控制

### 片段标识符

- 片段标识符可以是*任意文本*，在url中以*#为前缀*
- 片段标识符通常作为文档*某部分*的引用
- 当片段标识符变化时，html页面*不会刷新*
- 通过location对象的*onhashchange*事件来触发路由匹配以及后续动作

### HTML5的历史API

由于HTML5的历史API并不被所有浏览器兼容，大部分的路由器都默认支持*优雅降级到片段标识符*

- pushState() - 添加新的历史条目
- replaceState() - 替换已有的历史条目
- popstate事件 - 监听state变化

大部分路由器的实现方式：

- 允许选择HTML5的历史API或者片段标识符
- 需要在index.html中配置*基准连接*，与*部署路径*保持一致

```html
<head>
    <base href="/SPA/">
</head>
```

> href 用于文档中相对 URL 地址的基础 URL。如果指定了该属性，这个元素必须写在其他任何属性值是 URL 的元素之前。允许绝对和相对URL（但是请查看下面的注意节段）。

- 服务端需要进行配置，使其能够为*跟路径*返回数据
- 支持路由连接的配置
